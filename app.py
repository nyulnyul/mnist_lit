# -*- coding: utf-8 -*-
"""app.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1Jx2ITw_S-fgkzzJDob4U8WgvudTw_C7U
"""

import streamlit as st, numpy as np, joblib
from streamlit_drawable_canvas import st_canvas
from PIL import Image, ImageOps

st.title("ğŸ“ MNIST Digit Classifier")

@st.cache_resource
def load_model():
    return joblib.load("mnist_model.pkl")

model = load_model()

st.write("ìº”ë²„ìŠ¤ì— 0-9 ìˆ«ìë¥¼ ê·¸ë¦° ë’¤ **Predict**ë¥¼ ëˆŒëŸ¬ ë³´ì„¸ìš”!")

canvas = st_canvas(
    fill_color="white",
    stroke_width=10,
    stroke_color="black",
    background_color="white",
    height=280,
    width=280,
    drawing_mode="freedraw",
    key="canvas",
)

if st.button("Predict"):
    if canvas.image_data is not None:
        # ìº”ë²„ìŠ¤(alpha) â†’ 28Ã—28 ê·¸ë ˆì´ìŠ¤ì¼€ì¼(0~255)
        img = Image.fromarray((255 - canvas.image_data[:, :, 3]).astype("uint8"))
        img = img.resize((28, 28)).convert("L")
        img = ImageOps.invert(img)                 # í° ë°°ê²½Â·ê²€ì€ ê¸€ì”¨ë¡œ ë³€í™˜
        x = np.array(img).reshape(1, -1).astype(float)
        pred = model.predict(x)[0]
        st.success(f"ğŸ§® ì˜ˆì¸¡ ê²°ê³¼: **{pred}**")
    else:
        st.error("ë¨¼ì € ìˆ«ìë¥¼ ê·¸ë ¤ ì£¼ì„¸ìš”.")